<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - MG Cafe</title>
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>
        :root { --primary: #d32f2f; --dark: #333; --bg: #f4f6f8; }
        body { margin: 0; font-family: 'Open Sans', sans-serif; background: var(--bg); color: var(--dark); }
        
        /* Login Overlay */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: flex; align-items: center; justify-content: center;
        }
        .login-box { text-align: center; max-width: 300px; width: 100%; }
        .login-input { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; }
        .login-btn { width: 100%; padding: 10px; background: var(--primary); color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
        
        /* Dashboard Layout */
        header { background: #fff; padding: 15px 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; }
        h1 { margin: 0; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .logout-btn { color: var(--primary); text-decoration: none; font-weight: bold; font-size: 0.9rem; cursor: pointer; }
        
        .container { max-width: 1200px; margin: 30px auto; padding: 0 15px; }
        
        /* Stats Cards */
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); border-left: 4px solid var(--primary); }
        .stat-num { font-size: 2rem; font-weight: bold; }
        .stat-label { color: #666; font-size: 0.9rem; }

        /* Table */
        .table-container { background: #fff; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f9fafb; font-weight: 600; font-size: 0.85rem; text-transform: uppercase; color: #555; }
        tr:hover { background: #f5f5f5; }
        
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: bold; }
        .badge-pending { background: #fff3e0; color: #ef6c00; }
        .badge-confirmed { background: #e8f5e9; color: #2e7d32; }
        
        .action-btn { background: none; border: 1px solid #ddd; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; margin-right: 5px; }
        .action-btn:hover { background: #eee; }
        .btn-call { color: #2196f3; border-color: #2196f3; text-decoration: none; display: inline-block; }
    </style>
</head>
<body>

    <!-- Login Screen -->
    <div id="loginOverlay">
        <div class="login-box">
            <h2>Admin Login</h2>
            <p style="color: #666; margin-bottom: 20px;">Access MG Cafe Reservations</p>
            <form id="loginForm">
                <input type="password" id="passwordInput" class="login-input" placeholder="Enter Password" required>
                <button type="submit" class="login-btn">Login</button>
            </form>
            <p id="loginError" style="color: red; margin-top: 10px; display: none;">Incorrect password</p>
        </div>
    </div>

    <!-- Main Dashboard (Hidden until login) -->
    <div id="dashboard" style="display: none;">
        <header>
            <h1><i class="material-icons" style="color: var(--primary);">restaurant</i> MG Cafe Admin</h1>
            <a onclick="logout()" class="logout-btn">Logout</a>
        </header>

        <div class="container">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-num" id="totalCount">0</div>
                    <div class="stat-label">Total Bookings</div>
                </div>
                <div class="stat-card" style="border-color: #388e3c;">
                    <div class="stat-num" id="todayCount">0</div>
                    <div class="stat-label">Bookings for Today</div>
                </div>
            </div>

            <h2 style="margin-bottom: 20px;">Recent Reservations</h2>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Status</th>
                            <th>Date & Time</th>
                            <th>Customer</th>
                            <th>Details</th>
                            <th>Notes</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="bookingTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center;">Loading bookings...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getFirestore, collection, query, orderBy, onSnapshot, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // --- CONFIGURATION START ---
        
        // 1. SET YOUR ADMIN PASSWORD HERE
        // Note: For a static site, this is visible in source code. 
        // For higher security, you would need a backend, but this works for basic protection.
        const LOGIN_PASSWORD = "admin"; 

        // 2. PASTE YOUR FIREBASE CONFIG HERE (Same as index.html)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abc123456"
        };
        // --- CONFIGURATION END ---

        // Login Logic
        const loginForm = document.getElementById('loginForm');
        
        // Check session
        if(sessionStorage.getItem('isLoggedIn') === 'true') {
            showDashboard();
        }

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const input = document.getElementById('passwordInput').value;
            if(input === LOGIN_PASSWORD) {
                sessionStorage.setItem('isLoggedIn', 'true');
                showDashboard();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        });

        window.logout = function() {
            sessionStorage.removeItem('isLoggedIn');
            location.reload();
        }

        function showDashboard() {
            document.getElementById('loginOverlay').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            initFirebase();
        }

        function initFirebase() {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);

            // Real-time listener
            const q = query(collection(db, "bookings"), orderBy("timestamp", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const tbody = document.getElementById('bookingTableBody');
                tbody.innerHTML = ''; // Clear current

                let total = 0;
                let today = 0;
                const todayStr = new Date().toISOString().split('T')[0];

                snapshot.forEach((docSnapshot) => {
                    const data = docSnapshot.data();
                    const id = docSnapshot.id;
                    total++;
                    if(data.date === todayStr) today++;

                    const row = document.createElement('tr');
                    
                    // Status Badge Logic
                    const badgeClass = data.status === 'Confirmed' ? 'badge-confirmed' : 'badge-pending';
                    
                    row.innerHTML = `
                        <td><span class="badge ${badgeClass}">${data.status}</span></td>
                        <td>
                            <div style="font-weight: bold;">${data.date}</div>
                            <div style="font-size: 0.85rem; color: #666;">${data.time}</div>
                        </td>
                        <td>
                            <div style="font-weight: bold;">${data.name}</div>
                            <a href="tel:${data.phone}" class="btn-call" style="font-size: 0.85rem;">${data.phone}</a>
                        </td>
                        <td>
                            <div>${data.guests} Guests</div>
                            <div style="font-size: 0.85rem; color: #666;">${data.seating}</div>
                            <div style="font-size: 0.85rem; color: #888;">${data.occasion}</div>
                        </td>
                        <td style="max-width: 200px; font-size: 0.9rem; color: #555;">${data.notes || '-'}</td>
                        <td>
                            ${data.status !== 'Confirmed' ? 
                                `<button onclick="confirmBooking('${id}')" class="action-btn" style="color: green; border-color: green;">Confirm</button>` : 
                                '<span style="color: green;"><i class="material-icons" style="font-size: 16px; vertical-align: middle;">check</i> Done</span>'
                            }
                        </td>
                    `;
                    tbody.appendChild(row);
                });

                document.getElementById('totalCount').innerText = total;
                document.getElementById('todayCount').innerText = today;
            });

            // Make function global for onclick
            window.confirmBooking = async function(id) {
                try {
                    await updateDoc(doc(db, "bookings", id), {
                        status: "Confirmed"
                    });
                } catch(e) {
                    alert("Error updating: " + e.message);
                }
            }
        }
    </script>
</body>
</html>
