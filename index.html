<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MG Cafe & Restro - Authentic Bihari Cuisine & Modern Vibes. Book your table now.">
    <title>MG Cafe & Restro - Swad-E-Bihar</title>
    
    <!-- Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@300;400;700;900&family=Open+Sans:wght@300;400;600;700&family=Raleway:wght@300;400;500;700&family=Roboto+Slab:wght@100;400;700;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <style>
        /* --- ORIGINAL CSS RESTORED --- */
        :root {
            --primary: #d32f2f;
            --secondary: #388e3c;
            --dark: #212121;
            --light: #fff3e0;
            --gold: #ffb300;
            --facebook: #1877F2;
        }
        
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Open Sans', sans-serif; color: #333; line-height: 1.6; padding-bottom: 60px; background-color: #fff; }
        h1, h2, h3 { font-family: 'Merriweather', serif; }
        
        /* Layout */
        .container { max-width: 1140px; margin: 0 auto; padding: 0 15px; }
        .row { display: flex; flex-wrap: wrap; margin: 0 -15px; }
        .col { padding: 15px; flex: 1; min-width: 300px; display: flex; flex-direction: column; justify-content: center; }
        .img-fluid { max-width: 100%; height: auto; display: block; margin: 0 auto; }
        
        /* Editable Sections Wrapper */
        .gjs-ft-section { padding: 80px 0; position: relative; background-size: cover; background-position: center; }

        /* Typography */
        .hero-title { font-size: 3rem; color: #222; margin-bottom: 20px; font-weight: 900; line-height: 1.2; }
        .hero-title span { color: var(--primary); }
        .hero-subtitle { font-size: 1.3rem; margin-bottom: 30px; color: #444; }
        .section-title { text-align: center; font-size: 2.5rem; margin-bottom: 10px; color: #222; }
        .section-subtitle { text-align: center; color: #666; margin-bottom: 40px; }

        /* Buttons */
        .btn {
            display: inline-flex; align-items: center; justify-content: center;
            background: var(--primary); color: #fff; padding: 14px 35px; border-radius: 50px;
            text-decoration: none; font-weight: 700; text-transform: uppercase;
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4); transition: 0.3s; border: none; cursor: pointer;
        }
        .btn:hover { transform: translateY(-3px); background: #b71c1c; color: #fff; }
        .btn-green { background: var(--secondary); box-shadow: 0 4px 15px rgba(56, 142, 60, 0.4); }
        .btn-green:hover { background: #2e7d32; }
        
        /* Menu Cards */
        .menu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
        .menu-card {
            background: #fff; border-radius: 15px; padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08); text-align: center; transition: 0.3s;
            position: relative; border: 1px solid #eee; display: flex; flex-direction: column;
        }
        .menu-card:hover { transform: translateY(-10px); border-color: var(--primary); }
        .menu-img { height: 160px; object-fit: contain; margin-bottom: 15px; width: 100%; }
        .price { font-size: 1.5rem; font-weight: 900; color: var(--primary); margin-top: auto; padding-top: 15px; }
        .badge { position: absolute; top: 15px; left: 15px; background: var(--gold); color: #000; padding: 5px 10px; border-radius: 4px; font-weight: bold; font-size: 12px; z-index: 2; }

        /* Dark Sections */
        .bg-dark { background-color: var(--dark); color: #fff; }
        .bg-dark h1, .bg-dark h2 { color: var(--gold); }
        .bg-dark p { color: rgba(255,255,255,0.8); }

        /* Reservation Box */
        .reservation-box {
            background: #fff; padding: 40px; border-radius: 15px; color: #333;
            max-width: 700px; margin: 0 auto; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        /* Form Styles */
        .form-group { margin-bottom: 20px; text-align: left; }
        .form-label { font-size: 0.9rem; font-weight: 600; margin-bottom: 8px; display: block; color: #555; }
        .form-control {
            width: 100%; padding: 12px 15px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; background: #f9f9f9; transition: 0.3s;
        }
        .form-control:focus { outline: none; border-color: var(--secondary); background: #fff; box-shadow: 0 0 0 3px rgba(56, 142, 60, 0.1); }
        .form-row { display: flex; gap: 20px; }
        .form-row .form-group { flex: 1; }
        @media (max-width: 600px) { .form-row { flex-direction: column; gap: 0; } }

        /* Footer */
        footer { background: var(--dark); color: #fff; padding: 50px 0; text-align: center; }
        
        /* Mobile Stickies */
        .mobile-bar {
            position: fixed; bottom: 0; left: 0; width: 100%; background: #fff;
            display: flex; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); z-index: 1000;
        }
        .mobile-btn { flex: 1; padding: 15px; text-align: center; text-decoration: none; font-weight: bold; color: #fff; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .mb-call { background: var(--secondary); }
        .mb-book { background: var(--primary); }
        @media(min-width: 768px) { .mobile-bar { display: none; } }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; align-items: center; justify-content: center; backdrop-filter: blur(5px);
        }
        .modal.active { display: flex; }
        .modal-content { background: #fff; padding: 30px; border-radius: 15px; width: 90%; max-width: 450px; text-align: center; position: relative; box-shadow: 0 20px 50px rgba(0,0,0,0.3); }
        
        /* Loading Screen */
        #loading-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 9999; display: flex; flex-direction: column; 
            align-items: center; justify-content: center; transition: opacity 0.5s ease;
        }
        .spinner {
            border: 4px solid #f3f3f3; border-top: 4px solid #e84f4f; border-radius: 50%;
            width: 40px; height: 40px; animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* Hide content until loaded */
        #editable-content { opacity: 0; transition: opacity 0.5s ease; }
    </style>
</head>
<body>

    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="spinner"></div>
        <p style="font-family: 'Raleway', sans-serif; font-weight: 600; color: #555;">Loading MG Cafe...</p>
    </div>

    <!-- 
      EDITABLE CONTENT WRAPPER 
      Everything inside this <main> tag is editable via admin.html 
    -->
    <main id="editable-content">
        
        <!-- Hero -->
        <section id="hero-section" class="gjs-ft-section" style="background-image: linear-gradient(rgba(255,255,255,0.92), rgba(255,255,255,0.85)), url('https://img.flexifunnels.io/images/163/a2nzg_1920_banner.png');">
            <div class="container">
                <div class="row" style="align-items: center;">
                    <div class="col">
                        <img src="https://img.flexifunnels.io/images/163/i5ntg_139_logo1.png" style="height: 80px; margin-bottom: 20px; align-self: flex-start;">
                        <h1 class="hero-title">MG CAFE & RESTRO <br><span>SWAD-E-BIHAR</span></h1>
                        <p class="hero-subtitle">Authentic Champaran Meat House & Modern Family Cafe. The pride of Danapur.</p>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <a href="#booking-section" class="btn">Book VIP Table</a>
                            <a href="tel:+911234567890" class="btn btn-green"><i class="fas fa-phone-alt" style="margin-right: 8px;"></i> Call Now</a>
                        </div>
                    </div>
                    <div class="col">
                        <img src="https://img.flexifunnels.io/images/163/q5odg_564_image1.png" class="img-fluid" style="filter: drop-shadow(0 15px 15px rgba(0,0,0,0.3)); transform: scale(1.05);">
                    </div>
                </div>
            </div>
        </section>

        <!-- Menu Preview -->
        <section id="menu-section" class="gjs-ft-section">
            <div class="container">
                <h2 class="section-title">Our Favorites</h2>
                <p class="section-subtitle">A perfect blend of Desi flavors and Cafe delights.</p>
                
                <div class="menu-grid">
                    <!-- Item 1 -->
                    <div class="menu-card">
                        <span class="badge">SIGNATURE</span>
                        <img src="https://img.flexifunnels.io/images/163/i2mjg_120_service1.png" class="menu-img">
                        <h3>Champaran Mutton</h3>
                        <p>Slow-cooked in sealed earthen pots with whole garlic & spices.</p>
                        <div class="price">₹250</div>
                        <button class="btn btn-green book-trigger" style="margin-top: 15px;">Book This</button>
                    </div>
                    <!-- Item 2 -->
                    <div class="menu-card">
                        <span class="badge" style="background: var(--primary); color: #fff;">AUTHENTIC</span>
                        <img src="https://img.flexifunnels.io/images/163/i2mjg_120_service1.png" class="menu-img">
                        <h3>Special Litti Chokha</h3>
                        <p>Traditional sattu litti dipped in pure desi ghee with baigan chokha.</p>
                        <div class="price">₹120</div>
                        <button class="btn btn-green book-trigger" style="margin-top: 15px;">Book This</button>
                    </div>
                    <!-- Item 3 -->
                    <div class="menu-card">
                        <span class="badge" style="background: #333; color: #fff;">CAFE SPECIAL</span>
                        <img src="https://img.flexifunnels.io/images/163/i2mjg_120_service1.png" class="menu-img">
                        <h3>Crispy Chicken Burger</h3>
                        <p>Juicy patty, fresh lettuce, melted cheese and cafe-style fries.</p>
                        <div class="price">₹149</div>
                        <button class="btn btn-green book-trigger" style="margin-top: 15px;">Book This</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Feature Section -->
        <section id="feature-section" class="gjs-ft-section bg-dark">
            <div class="container">
                <div class="row" style="align-items: center;">
                    <div class="col">
                        <img src="https://img.flexifunnels.io/images/163/e0nju_406_uczZVGkrbx406image2.png" class="img-fluid" style="filter: drop-shadow(0 20px 30px rgba(0,0,0,0.5)); transform: rotate(-5deg);">
                    </div>
                    <div class="col">
                        <h1>Ahuna Mutton Handi</h1>
                        <h2 style="font-size: 1.5rem; color: var(--gold); margin-bottom: 20px;">The Taste of Tradition.</h2>
                        <p style="font-size: 1.1rem; margin-bottom: 30px;">Our chefs prepare this delicacy with patience and passion. Using secret spice blends from Champaran, sealed in clay pots to retain every ounce of flavor.</p>
                        <a href="#booking-section" class="btn" style="border: 2px solid var(--primary); background: transparent; color: var(--primary);">Pre-Book Handi</a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Social / Facebook Section -->
        <section id="social-section" class="gjs-ft-section" style="background: #f0f2f5;">
            <div class="container" style="text-align: center;">
                <div style="background: #fff; padding: 30px; border-radius: 10px; display: inline-block; box-shadow: 0 4px 12px rgba(0,0,0,0.1); max-width: 500px; width: 100%;">
                    <img src="https://img.flexifunnels.io/images/163/i5ntg_139_logo1.png" style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid #eee; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #1c1e21;">MG Cafe & Restro Swad-E-Bihar</h3>
                    <p style="color: #65676b; margin: 5px 0 15px;">Restaurant · Danapur, Patna</p>
                    <div style="color: var(--facebook); margin-bottom: 20px;">
                        <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i> 
                        <span style="color: #65676b; font-weight: 600; margin-left: 5px;">4.5 Rating</span>
                    </div>
                    <a href="#" class="btn" style="background: var(--facebook); width: 100%; box-shadow: none;"><i class="fab fa-facebook-square" style="margin-right: 8px;"></i> Connect on Facebook</a>
                </div>
            </div>
        </section>

        <!-- Map Section -->
        <section id="map-section" class="gjs-ft-section" style="padding: 100px 0; background-image: url('https://img.flexifunnels.io/images/163/g4ode_1920_map.png'); background-attachment: fixed;">
            <div class="container" style="text-align: center;">
                <a href="https://www.google.com/maps/place/MG+CAFE+%26+RESTRO+SWAD-E-+BIHAR/@25.5994799,85.1700191,17z" target="_blank" class="btn" style="background: white; color: var(--primary); font-size: 1.2rem;">
                    <i class="material-icons" style="vertical-align: middle; margin-right: 10px;">place</i> Locate Us on Google Maps
                </a>
                <p style="margin-top: 20px; color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.8); font-weight: 800; font-size: 1.2rem;">Near Danapur, Patna, Bihar 801503</p>
            </div>
        </section>

        <!-- Booking Section -->
        <section id="booking-section" class="gjs-ft-section" style="background-image: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://img.flexifunnels.io/images/163/cyntc_1920_bg.png');">
            <div class="container">
                <div class="reservation-box">
                    <h2 style="text-align: center; color: var(--primary);">Secure Your Table</h2>
                    <p style="text-align: center; margin-bottom: 30px;">Fill this form to reserve your spot instantly.</p>
                    
                    <form id="bookingForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="name" class="form-control" placeholder="Amit Kumar" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Phone Number</label>
                                <input type="tel" id="phone" class="form-control" placeholder="9876543210" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Date</label>
                                <input type="date" id="date" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time</label>
                                <input type="time" id="time" class="form-control" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Guests</label>
                                <select id="guests" class="form-control">
                                    <option value="2">2 People</option>
                                    <option value="4">4 People</option>
                                    <option value="6">6 People</option>
                                    <option value="8">8 People</option>
                                    <option value="10+">10+ (Group)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Seating Preference</label>
                                <select id="seating" class="form-control">
                                    <option value="Indoor AC">Indoor AC Hall</option>
                                    <option value="Rooftop">Rooftop (Open Air)</option>
                                    <option value="Private Cabin">Private Family Cabin</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Occasion</label>
                            <select id="occasion" class="form-control">
                                <option value="Casual Dining">Casual Dining</option>
                                <option value="Birthday Party">Birthday Party</option>
                                <option value="Anniversary">Anniversary</option>
                                <option value="Business Meeting">Business Meeting</option>
                                <option value="Date Night">Date Night</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Dietary Restrictions / Special Requests</label>
                            <textarea id="notes" class="form-control" rows="2" placeholder="e.g., Less spicy, Cake arrangement, Jain food..."></textarea>
                        </div>

                        <button type="submit" class="btn" style="width: 100%; margin-top: 10px;">Confirm Reservation</button>
                    </form>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <div class="container">
                <h3>MG Cafe & Restro</h3>
                <p>Danapur, Patna, Bihar 801503</p>
                <div style="margin: 20px 0;">
                    <a href="#" class="btn" style="background: rgba(255,255,255,0.1); padding: 8px 15px; font-size: 0.9rem;">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="btn" style="background: rgba(255,255,255,0.1); padding: 8px 15px; font-size: 0.9rem; margin-left: 10px;">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
                <p style="font-size: 0.8rem; opacity: 0.7;">&copy; 2025 Swad-E-Bihar. All Rights Reserved.</p>
            </div>
        </footer>

    </main>
    <!-- End of Editable Content -->

    <!-- Mobile Sticky Bar -->
    <div class="mobile-bar">
        <a href="tel:+911234567890" class="mobile-btn mb-call"><i class="fas fa-phone-alt"></i> Call</a>
        <a href="#booking-section" class="mobile-btn mb-book"><i class="fas fa-calendar-check"></i> Book Table</a>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <button onclick="document.getElementById('successModal').classList.remove('active')" style="position: absolute; right: 20px; top: 20px; background: none; border: none; font-size: 1.5rem; cursor: pointer;">&times;</button>
            <i class="fas fa-check-circle" style="font-size: 60px; color: var(--secondary); margin-bottom: 20px;"></i>
            <h3 style="color: var(--secondary); margin-bottom: 10px;">Booking Requested!</h3>
            <p>Thank you, <span id="modalName" style="font-weight: bold;"></span>.</p>
            <p>We have received your request for <span id="modalGuests" style="font-weight: bold;"></span> people on <span id="modalDate" style="font-weight: bold;"></span>.</p>
            <p style="font-size: 0.9rem; color: #666; margin-top: 15px;">We will call you shortly on your number to confirm.</p>
            <button class="btn" onclick="document.getElementById('successModal').classList.remove('active')" style="margin-top: 20px; width: 100%;">Okay, Great!</button>
        </div>
    </div>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

        // Use environment config if available (Fix for "System Fucked" issue: connect to correct project)
        let firebaseConfig;
        if (typeof __firebase_config !== 'undefined') {
            firebaseConfig = JSON.parse(__firebase_config);
        } else {
             firebaseConfig = {
                apiKey: "AIzaSyCdjr6GwvNtC-qqLhX7X0eOCZk54orEBto",
                authDomain: "fir-711c2.firebaseapp.com",
                projectId: "fir-711c2",
                storageBucket: "fir-711c2.firebasestorage.app",
                messagingSenderId: "212609923784",
                appId: "1:212609923784:web:43c274cea203256e2943fd",
            };
        }

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';

        // 1. Dynamic Content Loading
        async function loadDynamicContent() {
            const loadingScreen = document.getElementById('loading-screen');
            const content = document.getElementById('editable-content');
            
            // Safety Timer: If Firebase takes too long (5s), remove loader anyway
            const safetyTimer = setTimeout(() => {
                if(loadingScreen.style.display !== 'none') {
                    console.warn("Forcing loader removal due to timeout");
                    loadingScreen.style.opacity = '0';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                        content.style.opacity = '1';
                    }, 500);
                }
            }, 5000);

            try {
                // Authenticate silently FIRST
                await signInAnonymously(auth);
                console.log("Connected to database.");

                // Use 'artifacts' path to find the saved content
                const docRef = doc(db, "artifacts", appId, "public", "data", "site_content", "live_page");
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    console.log("Loading live content from Firebase...");
                    const data = docSnap.data();
                    if(data.html) {
                        content.innerHTML = data.html;
                        bindPageEvents();
                    }
                } else {
                    console.log("Using default local content.");
                    bindPageEvents();
                }
            } catch (e) {
                console.error("Error loading dynamic content:", e);
                // Even on error, show the default HTML so the site is usable
                bindPageEvents();
            } finally {
                clearTimeout(safetyTimer);
                // Reveal Content
                loadingScreen.style.opacity = '0';
                setTimeout(() => {
                    loadingScreen.style.display = 'none';
                    content.style.opacity = '1';
                }, 500);
            }
        }
        
        // 2. Logic to re-attach listeners after DOM update
        function bindPageEvents() {
            // Bind "Book This" buttons in the menu
            const triggers = document.querySelectorAll('.book-trigger');
            triggers.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.getElementById('booking-section').scrollIntoView({behavior: 'smooth'});
                });
            });

            // Bind Form Submit (we need to re-find the form)
            const form = document.getElementById('bookingForm');
            if(form) {
                // Remove old listener to avoid duplicates if any
                const newForm = form.cloneNode(true);
                form.parentNode.replaceChild(newForm, form);
                
                newForm.addEventListener('submit', handleFormSubmit);
            }
        }

        // 3. Form Handler
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            const submitBtn = e.target.querySelector('button');
            const originalText = submitBtn.innerText;
            submitBtn.innerText = "Processing...";
            submitBtn.disabled = true;

            const name = document.getElementById('name').value;
            const guests = document.getElementById('guests').value;
            const date = document.getElementById('date').value;

            try {
                // Use 'artifacts' path for bookings
                await addDoc(collection(db, "artifacts", appId, "public", "data", "bookings"), {
                    name: name,
                    phone: document.getElementById('phone').value,
                    date: date,
                    time: document.getElementById('time').value,
                    guests: guests,
                    seating: document.getElementById('seating').value,
                    occasion: document.getElementById('occasion').value,
                    notes: document.getElementById('notes').value,
                    status: 'Pending',
                    timestamp: serverTimestamp()
                });

                document.getElementById('modalName').innerText = name;
                document.getElementById('modalGuests').innerText = guests;
                document.getElementById('modalDate').innerText = date;
                document.getElementById('successModal').classList.add('active');
                e.target.reset();

            } catch (error) {
                console.error("Error adding document: ", error);
                alert("Error submitting booking: " + error.message);
            }

            submitBtn.innerText = originalText;
            submitBtn.disabled = false;
        }
        
        // Start App
        loadDynamicContent();

    </script>
</body>
</html>
